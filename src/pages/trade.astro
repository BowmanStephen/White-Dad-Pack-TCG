---
import BaseLayout from '../layouts/BaseLayout.astro';
import TradeCreator from '../components/trade/TradeCreator.svelte';
import TradeOfferViewer from '../components/trade/TradeOfferViewer.svelte';
import TradeHistory from '../components/trade/TradeHistory.svelte';
import Navigation from '../components/common/Navigation.svelte';
import ErrorBoundary from '../components/common/ErrorBoundary.svelte';

// SEO for trade page
const title = "Trading Center - DadDeck Trading Card Game";
const description = "Create and manage trade offers with other players. Trade your duplicate dad-themed cards, complete your collection, and connect with the DadDeck community in this free browser TCG simulator.";
const tradePageURL = new URL('/trade', Astro.site).href;
const imageURL = new URL('/og-image.png', Astro.site).href;

// Get trade offer from URL parameter if present
const urlParam = Astro.url.searchParams.get('offer');
const hasOffer = !!urlParam;

// Structured data for trade page
const tradePageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "DadDeck Trading Center",
  "url": tradePageURL,
  "description": "Create and manage trade offers for DadDeck trading cards",
  "about": {
    "@type": "Thing",
    "name": "Card Trading",
    "description": "Trade dad-themed trading cards with other players"
  }
};
---

<BaseLayout
  title={title}
  description={description}
  image="/og-image.png"
>
  <ErrorBoundary component="Navigation" fallbackMessage="Navigation unavailable. Please reload the page.">
    <Navigation client:load />
  </ErrorBoundary>

  <!-- Page Header -->
  <div class="page-header">
    <div class="max-w-6xl mx-auto px-4 py-12 text-center">
      <h1 class="text-4xl md:text-5xl font-black text-white mb-4">
        <span class="text-amber-400">Trading</span> Center
      </h1>
      <p class="text-slate-400 text-lg">
        Create trade offers, share with friends, and grow your collection
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 pb-12">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Trade Creator (Left Column - 2/3 width) -->
      <div class="lg:col-span-2">
        <div class="bg-slate-900 rounded-xl border border-slate-700 p-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white">
              {hasOffer ? 'View Trade Offer' : 'Create Trade Offer'}
            </h2>
            <div class="flex gap-2">
              <a
                href="/trade"
                class:text-amber-400={hasOffer}
                class:text-slate-400={!hasOffer}
                class="hover:text-amber-300 transition-colors px-4 py-2 rounded-lg border border-slate-700 hover:border-amber-500"
              >
                Create Trade
              </a>
              <a
                href="/trade#history"
                class="text-slate-400 hover:text-amber-300 transition-colors px-4 py-2 rounded-lg border border-slate-700 hover:border-amber-500"
              >
                History
              </a>
            </div>
          </div>

          <ErrorBoundary
            component={hasOffer ? 'TradeOfferViewer' : 'TradeCreator'}
            fallbackMessage="Failed to load trade component. Please refresh the page."
          >
            {#if hasOffer}
              <TradeOfferViewer
                client:load
                offerData={urlParam || ''}
              />
            {:else}
              <TradeCreator client:load />
            {/if}
          </ErrorBoundary>
        </div>
      </div>

      <!-- Sidebar (Right Column - 1/3 width) -->
      <div class="lg:col-span-1">
        <!-- Trade Stats -->
        <div class="bg-slate-900 rounded-xl border border-slate-700 p-6 mb-6">
          <h3 class="text-xl font-bold text-white mb-4">Trade Activity</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-slate-400">Active Trades</span>
              <span class="text-amber-400 font-bold">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-400">Completed Trades</span>
              <span class="text-green-400 font-bold">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-slate-400">Pending Offers</span>
              <span class="text-yellow-400 font-bold">0</span>
            </div>
          </div>
        </div>

        <!-- How to Trade -->
        <div class="bg-slate-900 rounded-xl border border-slate-700 p-6">
          <h3 class="text-xl font-bold text-white mb-4">How to Trade</h3>
          <ol class="space-y-3 text-slate-300">
            <li class="flex gap-3">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500 text-slate-900 font-bold flex items-center justify-center text-sm">1</span>
              <span>Select cards from your collection to offer</span>
            </li>
            <li class="flex gap-3">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500 text-slate-900 font-bold flex items-center justify-center text-sm">2</span>
              <span>Choose cards you'd like in return</span>
            </li>
            <li class="flex gap-3">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500 text-slate-900 font-bold flex items-center justify-center text-sm">3</span>
              <span>Add your name and an optional message</span>
            </li>
            <li class="flex gap-3">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500 text-slate-900 font-bold flex items-center justify-center text-sm">4</span>
              <span>Share the URL with your trade partner</span>
            </li>
            <li class="flex gap-3">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-amber-500 text-slate-900 font-bold flex items-center justify-center text-sm">5</span>
              <span>They can view and accept your trade offer</span>
            </li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Trade History Section -->
    <div id="history" class="mt-8">
      <div class="bg-slate-900 rounded-xl border border-slate-700 p-6">
        <h2 class="text-2xl font-bold text-white mb-6">Trade History</h2>
        <ErrorBoundary
          component="TradeHistory"
          fallbackMessage="Failed to load trade history. Please refresh the page."
        >
          <TradeHistory client:load />
        </ErrorBoundary>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .page-header {
    background: linear-gradient(180deg, rgba(245, 158, 11, 0.1) 0%, transparent 100%);
  }
</style>

<script define:vars={{ tradePageSchema }}>
  // Add structured data
  const schemaScript = document.createElement('script');
  schemaScript.type = 'application/ld+json';
  schemaScript.text = JSON.stringify(tradePageSchema);
  document.head.appendChild(schemaScript);
</script>
