---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navigation from '../../components/common/Navigation.svelte';
import Footer from '../../components/landing/Footer.astro';

// SEO for API documentation page
const title = "DadDeck API - Developer Documentation";
const description = "Official DadDeck API documentation. Build apps and integrations with our public API. Includes OpenAPI spec, code examples, and interactive explorer.";
const image = "/api/og-image.png";

// Code examples as strings to avoid JSX parsing issues
const jsExample = `// Using the JavaScript SDK
import { DadDeckAPI } from './dadddeck-js.js';

const client = new DadDeckAPI({
  apiKey: process.env.DADDECK_API_KEY
});

// List all rare cards
const response = await client.cards.list({
  rarity: 'rare',
  pageSize: 50
});

console.log(response.data.cards);`;

const pythonExample = `# Install: pip install requests
from dadddeck_api import DadDeckAPI

client = DadDeckAPI(api_key="your_api_key_here")

# Generate a pack
response = client.packs.generate(count=1, pack_type="standard")
pack = response.data

print(f"Pack ID: {pack['id']}")
print(f"Cards: {len(pack['cards'])}")
print(f"Best rarity: {pack['bestRarity']}")`;

const curlExample = `curl "https://api.dadddeck.com/v1/cards" \\
  -H "Authorization: Bearer YOUR_API_KEY"

curl -X POST "https://api.dadddeck.com/v1/packs/generate" \\
  -H "Authorization: Bearer YOUR_API_KEY" \\
  -H "Content-Type: application/json" \\
  -d '{"count": 1, "packType": "standard"}'`;

const requestBodyExample = `{
  "packType": "standard",  // or "premium"
  "count": 1,             // 1-10 packs
  "design": "standard",   // optional
  "series": 1             // optional
}`;

const responseFormatExample = `{
  "success": true,
  "data": { ... },
  "meta": {
    "requestId": "req_abc123",
    "timestamp": "2026-01-17T12:00:00Z",
    "version": "1.0.0",
    "rateLimit": {
      "limit": 10,
      "remaining": 9,
      "resetAt": "2026-01-17T12:01:00Z",
      "tier": "free"
    }
  }
}`;
---

<BaseLayout title={title} description={description} image={image}>
  <Navigation client:load />

  <main id="main-content" class="pt-16" tabindex="-1" role="main">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
      <!-- Header -->
      <header class="mb-12">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
          Developer API
        </h1>
        <p class="text-xl text-gray-600 max-w-3xl">
          Build powerful integrations with the DadDeck Trading Card Game API.
          Access cards, generate packs, query collections, and more.
        </p>

        <!-- Quick Links -->
        <div class="mt-8 flex flex-wrap gap-4">
          <a href="#authentication" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
            Get API Key
          </a>
          <a href="#endpoints" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            View Endpoints
          </a>
          <a href="/api/openapi.yaml" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition" download>
            Download OpenAPI Spec
          </a>
          <a href="#examples" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
            Code Examples
          </a>
        </div>
      </header>

      <!-- Rate Limiting Tiers -->
      <section id="rate-limits" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Rate Limiting Tiers</h2>
        <p class="text-gray-600 mb-6">
          Choose the tier that fits your needs. All tiers include access to card data and search.
        </p>

        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Free Tier -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Free</h3>
            <p class="text-3xl font-bold text-gray-900 mb-4">$0<span class="text-sm text-gray-500">/mo</span></p>
            <ul class="space-y-2 text-sm text-gray-600 mb-4">
              <li>10 requests/minute</li>
              <li>500 requests/day</li>
              <li>Read cards & search</li>
              <li>View leaderboard</li>
            </ul>
            <a href="#authentication" class="block text-center px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50">
              Get Started
            </a>
          </div>

          <!-- Basic Tier -->
          <div class="border border-gray-200 rounded-lg p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Basic</h3>
            <p class="text-3xl font-bold text-gray-900 mb-4">$9.99<span class="text-sm text-gray-500">/mo</span></p>
            <ul class="space-y-2 text-sm text-gray-600 mb-4">
              <li>60 requests/minute</li>
              <li>10,000 requests/day</li>
              <li>Everything in Free</li>
              <li>Generate packs</li>
              <li>Event data access</li>
            </ul>
            <a href="#authentication" class="block text-center px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
              Upgrade to Basic
            </a>
          </div>

          <!-- Pro Tier -->
          <div class="border border-gray-300 rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Pro</h3>
            <p class="text-3xl font-bold text-gray-900 mb-4">$49.99<span class="text-sm text-gray-500">/mo</span></p>
            <ul class="space-y-2 text-sm text-gray-600 mb-4">
              <li>300 requests/minute</li>
              <li>100,000 requests/day</li>
              <li>Everything in Basic</li>
              <li>Open packs via API</li>
              <li>Collection access</li>
              <li>Webhooks</li>
            </ul>
            <a href="#authentication" class="block text-center px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
              Upgrade to Pro
            </a>
          </div>

          <!-- Enterprise Tier -->
          <div class="border-2 border-purple-300 rounded-lg p-6 bg-purple-50">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Enterprise</h3>
            <p class="text-3xl font-bold text-gray-900 mb-4">$499.99<span class="text-sm text-gray-500">/mo</span></p>
            <ul class="space-y-2 text-sm text-gray-600 mb-4">
              <li>1,000 requests/minute</li>
              <li>1M requests/day</li>
              <li>Everything in Pro</li>
              <li>Write collections</li>
              <li>Admin access</li>
              <li>SLA guarantee</li>
            </ul>
            <a href="mailto:api@dadddeck.com" class="block text-center px-4 py-2 bg-purple-600 text-white rounded text-sm hover:bg-purple-700">
              Contact Sales
            </a>
          </div>
        </div>
      </section>

      <!-- Authentication -->
      <section id="authentication" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Authentication</h2>
        <p class="text-gray-600 mb-6">
          All API requests require an API key passed in the Authorization header:
        </p>

        <div class="bg-gray-900 text-gray-100 rounded-lg p-4 mb-6 overflow-x-auto">
          <pre class="text-sm"><code>Authorization: Bearer YOUR_API_KEY</code></pre>
        </div>

        <h3 class="text-lg font-bold text-gray-900 mb-3">Creating an API Key</h3>
        <p class="text-gray-600 mb-4">
          Generate API keys from your account settings. Each key can be assigned a tier and permissions.
        </p>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h4 class="font-bold text-blue-900 mb-2">Key Format</h4>
          <code class="text-sm text-blue-800">ddpk_live_abc123def456789abc123def456789ab</code>
          <p class="text-sm text-blue-700 mt-2">
            Keys start with <code>ddpk_</code> followed by environment (live/test/dev) and a 32-character random string.
          </p>
        </div>
      </section>

      <!-- Quick Start -->
      <section id="quickstart" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Quick Start</h2>

        <!-- JavaScript Example -->
        <div class="mb-8">
          <h3 class="text-lg font-bold text-gray-900 mb-3">JavaScript (Node.js/Browser)</h3>
          <div class="bg-gray-900 text-gray-100 rounded-lg p-4 overflow-x-auto">
            <pre class="text-sm"><code set:text={jsExample}></code></pre>
          </div>
        </div>

        <!-- Python Example -->
        <div class="mb-8">
          <h3 class="text-lg font-bold text-gray-900 mb-3">Python</h3>
          <div class="bg-gray-900 text-gray-100 rounded-lg p-4 overflow-x-auto">
            <pre class="text-sm"><code set:text={pythonExample}></code></pre>
          </div>
        </div>

        <!-- cURL Example -->
        <div>
          <h3 class="text-lg font-bold text-gray-900 mb-3">cURL</h3>
          <div class="bg-gray-900 text-gray-100 rounded-lg p-4 overflow-x-auto">
            <pre class="text-sm"><code set:text={curlExample}></code></pre>
          </div>
        </div>
      </section>

      <!-- Endpoints -->
      <section id="endpoints" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">API Endpoints</h2>

        <div class="space-y-6">
          <!-- Cards Endpoint -->
          <div class="border border-gray-200 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded">GET</span>
              <code class="text-lg font-mono">/cards</code>
            </div>
            <p class="text-gray-600 mb-4">
              Retrieve a paginated list of all cards in the database with optional filters.
            </p>
            <h4 class="font-bold text-gray-900 mb-2">Query Parameters</h4>
            <ul class="grid md:grid-cols-2 gap-2 text-sm">
              <li><code class="text-gray-700">page</code> - Page number (default: 1)</li>
              <li><code class="text-gray-700">pageSize</code> - Items per page (default: 50, max: 100)</li>
              <li><code class="text-gray-700">rarity</code> - Filter by rarity</li>
              <li><code class="text-gray-700">type</code> - Filter by dad type</li>
              <li><code class="text-gray-700">series</code> - Filter by series</li>
              <li><code class="text-gray-700">search</code> - Search in name/flavor text</li>
            </ul>
          </div>

          <!-- Pack Generation -->
          <div class="border border-gray-200 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-bold rounded">POST</span>
              <code class="text-lg font-mono">/packs/generate</code>
            </div>
            <p class="text-gray-600 mb-4">
              Generate one or more random packs based on rarity probabilities.
            </p>
            <h4 class="font-bold text-gray-900 mb-2">Request Body</h4>
            <div class="bg-gray-100 rounded p-3 text-sm">
              <code set:text={requestBodyExample}></code>
            </div>
          </div>

          <!-- Collections -->
          <div class="border border-gray-200 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded">GET</span>
              <code class="text-lg font-mono">/collections/&#123;userId&#125;</code>
            </div>
            <p class="text-gray-600 mb-4">
              Retrieve a user's card collection (requires proper permissions).
            </p>
            <p class="text-sm text-blue-600">
              <strong>Note:</strong> Requires <code>collections:read</code> permission (Pro tier or higher).
            </p>
          </div>

          <!-- Leaderboard -->
          <div class="border border-gray-200 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded">GET</span>
              <code class="text-lg font-mono">/leaderboard</code>
            </div>
            <p class="text-gray-600 mb-4">
              Get the current global rankings.
            </p>
            <h4 class="font-bold text-gray-900 mb-2">Query Parameters</h4>
            <ul class="text-sm">
              <li><code class="text-gray-700">limit</code> - Number of entries (default: 100, max: 1000)</li>
              <li><code class="text-gray-700">offset</code> - Entries to skip (default: 0)</li>
            </ul>
          </div>

          <!-- Events -->
          <div class="border border-gray-200 rounded-lg p-6">
            <div class="flex items-center gap-3 mb-4">
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded">GET</span>
              <code class="text-lg font-mono">/events</code>
            </div>
            <p class="text-gray-600 mb-4">
              List all active, upcoming, and recent live events.
            </p>
          </div>
        </div>
      </section>

      <!-- Response Format -->
      <section id="response-format" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Response Format</h2>
        <p class="text-gray-600 mb-6">
          All API responses follow a standard format with success status, data, and metadata.
        </p>

        <div class="bg-gray-100 rounded-lg p-4">
          <pre class="text-sm"><code set:text={responseFormatExample}></code></pre>
        </div>
      </section>

      <!-- Error Handling -->
      <section id="errors" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Error Handling</h2>
        <p class="text-gray-600 mb-6">
          API errors return a structured error response with codes and messages.
        </p>

        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-gray-200">
                <th class="text-left py-2 px-4">Status</th>
                <th class="text-left py-2 px-4">Code</th>
                <th class="text-left py-2 px-4">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b border-gray-100">
                <td class="py-2 px-4"><span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">400</span></td>
                <td class="py-2 px-4 font-mono text-sm">BAD_REQUEST</td>
                <td class="py-2 px-4">Invalid parameters</td>
              </tr>
              <tr class="border-b border-gray-100">
                <td class="py-2 px-4"><span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">401</span></td>
                <td class="py-2 px-4 font-mono text-sm">UNAUTHORIZED</td>
                <td class="py-2 px-4">Missing or invalid API key</td>
              </tr>
              <tr class="border-b border-gray-100">
                <td class="py-2 px-4"><span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">403</span></td>
                <td class="py-2 px-4 font-mono text-sm">FORBIDDEN</td>
                <td class="py-2 px-4">Insufficient permissions</td>
              </tr>
              <tr class="border-b border-gray-100">
                <td class="py-2 px-4"><span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded">404</span></td>
                <td class="py-2 px-4 font-mono text-sm">NOT_FOUND</td>
                <td class="py-2 px-4">Resource not found</td>
              </tr>
              <tr class="border-b border-gray-100">
                <td class="py-2 px-4"><span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">429</span></td>
                <td class="py-2 px-4 font-mono text-sm">RATE_LIMIT_EXCEEDED</td>
                <td class="py-2 px-4">Rate limit exceeded</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Code Examples -->
      <section id="examples" class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Code Examples</h2>
        <p class="text-gray-600 mb-6">
          Download official SDKs and view example implementations.
        </p>

        <div class="grid md:grid-cols-3 gap-4">
          <a href="/api/examples/dadddeck-js.js" class="block border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
            <h3 class="font-bold text-gray-900 mb-2">JavaScript SDK</h3>
            <p class="text-sm text-gray-600">Modern ES6+ client for Node.js and browsers</p>
          </a>
          <a href="/api/examples/dadddeck_api.py" class="block border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
            <h3 class="font-bold text-gray-900 mb-2">Python SDK</h3>
            <p class="text-sm text-gray-600">Python 3.7+ client with requests library</p>
          </a>
          <a href="/api/openapi.yaml" class="block border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
            <h3 class="font-bold text-gray-900 mb-2">OpenAPI Spec</h3>
            <p class="text-sm text-gray-600">Complete API specification in YAML format</p>
          </a>
        </div>
      </section>
    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  /* Smooth scroll for anchor links */
  html {
    scroll-behavior: smooth;
  }
</style>
