---
import PerformanceMonitor from '../components/common/PerformanceMonitor.astro';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = "DadDeck - The Ultimate White Dad Trading Card Simulator",
  description = "Open digital booster packs featuring collectible dad-themed cards. Free, hilarious, and endlessly entertaining."
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    
    <!-- Open Graph / Social -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="/og-image.png" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#f59e0b" />

    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Performance Monitoring (dev only) -->
    <PerformanceMonitor />
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white antialiased">
    <!-- Skip Navigation Link -->
    <a
      href="#main-content"
      class="skip-link"
    >
      Skip to main content
    </a>
    <slot />

    <!-- Service Worker Registration -->
    <script define:vars={{}}>
      // Only register service worker in production and when supported
      if ('serviceWorker' in navigator && import.meta.env.PROD) {
        window.addEventListener('load', async () => {
          try {
            const registration = await navigator.serviceWorker.register('/sw.js', {
              scope: '/'
            });

            console.log('[SW] Service Worker registered:', registration.scope);

            // Listen for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New version available
                    console.log('[SW] New content is available; please refresh.');
                    // You could show a notification to the user here
                  }
                });
              }
            });
          } catch (error) {
            console.error('[SW] Service Worker registration failed:', error);
          }
        });
      }

      // Handle online/offline events
      window.addEventListener('online', () => {
        console.log('[App] Connection restored');
        document.body.classList.remove('offline');
      });

      window.addEventListener('offline', () => {
        console.log('[App] Connection lost');
        document.body.classList.add('offline');
      });

      // Set initial state
      if (!navigator.onLine) {
        document.body.classList.add('offline');
      }
    </script>
  </body>
</html>

<style is:global>
  @tailwind base;
  @tailwind components;
  @tailwind utilities;

  /* Skip Navigation Link */
  .skip-link {
    position: absolute;
    top: -100%;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: #0f172a;
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    font-weight: 700;
    text-decoration: none;
    z-index: 10000;
    transition: top 0.3s ease;
  }

  .skip-link:focus {
    top: 1rem;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #1e293b;
  }
  
  ::-webkit-scrollbar-thumb {
    background: #475569;
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: #64748b;
  }
  
  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }
  
  /* Disable text selection on interactive elements */
  .no-select {
    user-select: none;
    -webkit-user-select: none;
  }
  
  /* Card perspective container */
  .perspective {
    perspective: 1000px;
  }
  
  /* 3D transform preservation */
  .preserve-3d {
    transform-style: preserve-3d;
  }
  
  /* Backface hidden */
  .backface-hidden {
    backface-visibility: hidden;
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Offline indicator */
  body.offline::before {
    content: 'You\'re offline - some features may be limited';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(90deg, #dc2626, #b91c1c);
    color: white;
    text-align: center;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    z-index: 10001;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  body.offline {
    padding-top: 2.5rem;
  }
</style>
